<!DOCTYPE html>
<meta charset="utf-8">

<style>
	svg {
		border:2px solid black;
	}
	.jscolor {
		opacity: 0.5; /* change this to 1 */
		width: 10px;
		height: 10px;
		pointer-events: none;
		position: absolute;
	}
</style>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="../js/jscolor.min.js"></script>

<body>
	<h1> d3.js continuous scale</h1>
	<div style="height:100px;" id="canvasDiv">
		<div> </div>
		<div id="pickerDiv" style="width: 500px; height: 50px">
			<input id="color1" style="left: 25px;" data-jscolor='{width:100, height: 50, valueElement: "foobar", onFineChange:"updateColor()", padding:0, shadow:false,
    borderWidth:0, backgroundColor:"transparent", insetColor:"#000"}' class="jscolor" colorActive=false; onchange='this.jscolor.hide();'>
		</div>
		<div id="sliderDiv" style= "position: absolute; left: 190px;">
			<input type="range" min="2" max="50" value="5" id="blockSlider">
			<label>5</label>
		</div>
	</div>

	<script>
		var numBlocks = 5;
		var width = 500;
		var height = 50;
		var blockWidth = width/numBlocks;
		var canvas = d3.select("#canvasDiv").select("div").append("svg")
			.attr("width", width)
			.attr("height", height)

		var color1 = d3.select("#color1")
		var color2 = d3.select("#color2")

		var data = [];
		var pickerData = [];

		//create groups for rects and circles
		var rectGroup = canvas.append("g");

		// initial blocks
		for (var i = 0; i < numBlocks; i++) {
			rectGroup.append("rect")
				.attr("x", i*blockWidth)
				.attr("width", blockWidth)
				.attr("height", height);
			data.push(i*blockWidth); // data array contains x positions of each block
		}

		canvas.append("circle")
			.attr("cx", "25")
			.attr("cy", "25")
			.attr("r", "10")
			.attr("stroke", "#000000") // black outline
			.attr("stroke-width", "2")
			.attr("fill", "#ff0000")
			.attr("id","foobar")
			.on("click", function() {
				document.getElementById("color1").jscolor.show()
			})

		var colorScale = d3.scaleLinear()
			.domain([data[0],data[data.length-1]]) // input is first and last x-position data
			.range(['#ff0000','#0000ff']);

		var pickers = canvas.selectAll("circle")

		var blocks = rectGroup.selectAll("rect")
			.data(data)
			.attr("fill", function(d) {return colorScale(d)});

		function updateColor() {
			console.log("updateColor");
			console.log('#'+d3.select("#foobar").html())
			colorScale.range([
				'#'+d3.select("#foobar").html(),
				'#000000'
				//'#'+d3.select("#color2").property("value")
			]);
			update()
		}

		d3.select("#blockSlider").on("input", function() {
			numBlocks = this.value;
			blockWidth = width/numBlocks;
			d3.select("label").html(this.value);
			data = [];
			for (var i = 0; i < numBlocks; i++) {
				data[i] = i*blockWidth;
			}
			colorScale.domain([data[0],data[data.length-1]]); // input is first and last x-position data
	  		update();
		});

		function update() {
			var blocks = rectGroup.selectAll("rect")
				.data(data)
				.attr("x", function(d) {return d})
				.attr("width", blockWidth)
				.attr("fill", function(d) {return colorScale(d)});
			blocks.enter().append("rect")
				.attr("x", function(d) {return d})
				.attr("width", blockWidth)
				.attr("height", height)
				.attr("fill", function(d) {return colorScale(d)});
			blocks.exit().remove();
		}

	</script>

</body>
