<!DOCTYPE html>
<meta charset="utf-8">
<html lang="en">

<style>
	body {
		padding-top: 70px;
		padding-bottom: 30px;
	}
	circle {
		stroke: black;
	}
	.dragging {
		stroke: white;
	}
	.jscolor {
		opacity: 1;
		width: 10px;
		height: 0px;
		pointer-events: none;
		position: absolute;
	}
	svg text {
		cursor: default;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
	}

	.glyphicon-refresh-animate {
		-animation: spin .7s infinite linear;
		-webkit-animation: spin2 .7s infinite linear;
	}

	@-webkit-keyframes spin2 {
		from { -webkit-transform: rotate(0deg);}
		to { -webkit-transform: rotate(360deg);}
	}

	@keyframes spin {
		from { transform: scale(1) rotate(0deg);}
		to { transform: scale(1) rotate(360deg);}
	}

	.scrollable-menu {
		height: auto;
		max-height: 300px;
		overflow-x: hidden;
	}
</style>
<head>
	<link href="../css/bootstrap.min.css" rel="stylesheet">
	<link href="../css/bootstrap-theme.min.css" rel="stylesheet">
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/d3-axis.v1.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="../js/bootstrap.min.js"></script>
	<script src="../js/jscolor.js"></script>

	<!--  bootstrap-select -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/i18n/defaults-en_US.min.js"></script>
	<script>
		var genes;

		// get 100 gene ids
		d3.request("read_ids.php", function(data) {
			$('#geneButton').html('Select a gene<span class="caret"></span>');
			genes = JSON.parse(data.response);
			populateDropdowns(genes.slice(0, 100)); // take only the first 100 genes
		});
	</script>
</head>

<body>
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">

			<div id="navbar" class="navbar-collapse collapse">
			</div>
		</div>
	</nav>
	<div class="container theme-showcase" style="width: 970px !important;" role="main">
		<div class="btn-group">
            <button id="geneButton" type="button" style="width: 175px;" class="btn btn-default dropdown-toggle" data-toggle="dropdown">

				 Loading... <span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>
				<!-- Select a gene<span class="caret"></span> -->
			</button>
            <ul id="geneMenu" class="dropdown-menu scrollable-menu" role="menu">
                <!-- <li><a href="#">Action</a></li> -->
            </ul>
        </div>
		<div  style="display: inline;">
			<!-- <select id="genePicker1" class="selectpicker" data-live-search="true" data-size="10">
				<option data-content='<span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Loading...'></option>
			</select> -->
		</div>
		<div id="svgContainer" style=" float: none; margin: 0 auto; border: 3px solid black"></div>
		<!-- <div class="row">

			<div class="col-xs-6 col-md-4">.col-xs-6 .col-md-4</div>
		</div> -->
	</div>
</body>

<script>
	$(document).ready(function() {
		$('#geneMenu').scroll(function() {
			console.log("scroll");
		});
	})
	function populateDropdowns(items) {
		var options = d3.select("#geneMenu").selectAll("li");

		options.remove(); // remove options

		//	<!-- <li><a href="#">Action</a></li> -->
		options.data(items)
		.enter()
			.append("li")
			.append("a")
			.html(function(d,i) {return d});
		options.exit().remove(); // remove any options not in the data

		console.log("refresh dropdown");
		$('.selectpicker').selectpicker('refresh');
	}

	var margin = {top: 30, right: 120, bottom: 30, left: 50},
	    width = 960 - margin.left - margin.right,
	    height = 500 - margin.top - margin.bottom;
	var heatMapSVG = d3.select("#svgContainer").append("svg")
		.attr("width", 960)
		.attr("height", 500)
		.append("g")
			.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
			.style("border", "3px solid black");

	var buckets = [{id:"1"},{id:"2"},{id:"3"},{id:"4"},{id:"5"}];
	// a.forEach(function(element) {
	// 	console.log(element);
	// });
	var x = d3.scaleLinear().range([0, width]),
		y = d3.scaleLinear().range([height, 0]);
	x.domain(d3.extent(buckets, function(d) { return d.id; }));
	// Add an x-axis with label.
	// var axis = d3.axisBottom(x);

	var blocks = heatMapSVG.append("g").selectAll("blocks")
		//.data
		// .append("rect")
		// 	.attr("width",width)
		// 	.attr("height",height)
		// 	.attr("fill", "#EEEEEE")

	heatMapSVG.append("g")
		.attr("class", "x axis")
		.attr("transform", "translate(0," + height + ")")
		.call(d3.axisBottom(x))
	heatMapSVG.append("g")
		.attr("class", "y axis")
		.call(d3.axisLeft(y))

	var colorScale = d3.scaleLinear()
		.domain([0,10]) // input is first and last x-position data
		.range(['#ff0000','#0000ff']);

	// Add a legend for the color values. height 100
	var legendLength = 300;

    var legend = heatMapSVG.append("g")
		.style("border", "1px solid black")
		.attr("transform", "translate("+(width+20)+","+(20)+")");

	var scaleRectangleWidth = 30,
		scaleRectangleHeight = 30;

	legend.selectAll("rect")
		.data([{p:""},{p:""},{p:""},{p:""},{p:""},{p:""},{p:""},{p:""},
			{p:""},{p:""}])
		.enter().append("rect")
			.attr("width", scaleRectangleWidth)
			.attr("height", scaleRectangleHeight)
			.attr("x", 0)
			.attr("y", function(d,i) {return i*scaleRectangleHeight})
			.attr("fill", function(d,i) {return colorScale(i)});

	var pivotData = [{y: 0, color: "#ff0000"},{y: legendLength, color: "#0000ff"}];

	legend.selectAll(".pivot")
		.data(pivotData)
			.enter()
			.append("path")
				.attr("class", "pivot")
				.each(function(d,i) {
					d3.select(this).attr("transform", "translate("+scaleRectangleWidth+","+d.y+")");
				})
				.style("width", 64)
				.style("height",64)
				.attr("fill","#000000")
				.attr("d","M26 -10 L26 10 L0 0 Z")

	//add text above the legend
	heatMapSVG.append("text")
		.attr("class", "label")
		.attr("x", width + 20)
		.attr("y", 10)
		.attr("dy", ".35em")
		.text("Legend");

	var drag = d3.drag()
		.on("start", function() { d3.select(this).raise().classed("dragging", true)} )
		.on("drag", function(d) {
			d.y += d3.event.dy
			d3.select(this).attr("cx", function(){
				return d.x;
			})
			d3.select("#"+d.input).style("left", d.x+"px")
			var domain = [];
			var range = [];
			d3.selectAll("circle")
				.sort(function(d1,d2) {
					return d1.x >= d2.x ? 1 : -1;
				})
				.each(function(d) {
					domain.push(d.x);
					range.push("#"+d.color);
				});
			colorScale.domain(domain).range(range);
			update()
		})
		.on("end", function() {
			d3.select(this).classed("dragging", false)
		});

	function update() {

		var blocks = rectGroup.selectAll("rect")
			.data(data)
			.attr("x", function(d) {return d})
			.attr("width", blockWidth+buffer)
			.attr("fill", function(d) {return colorScale(d)});
		blocks.enter().append("rect")
			.attr("x", function(d) {return d})
			.attr("width", blockWidth+buffer)
			.attr("height", height)
			.attr("fill", function(d) {return colorScale(d)});
		blocks.exit().remove();
	}

</script>

</html>
